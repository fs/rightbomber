// Generated by CoffeeScript 1.3.3
var Rightbomber,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Rightbomber = (function() {

  function Rightbomber() {
    this.tick = __bind(this.tick, this);

    this.run = __bind(this.run, this);
    console.log('init');
  }

  Rightbomber.prototype.run = function() {
    var gameLoop, map, mapView, table;
    console.log('run');
    map = new Map;
    map.generate();
    mapView = new MapView(map);
    table = mapView.render();
    $(document.body).append(table);
    this.keyboard = new Keyboard;
    this.keyboard.activate();
    this.player = new Player;
    this.playerRepresentation = new Representation(document.body, this.player);
    this.player.isPassable = function(position) {
      var epsilon, x1, x2, y1, y2;
      epsilon = 0.05;
      x1 = Math.floor(position.x + epsilon);
      y1 = Math.floor(position.y + epsilon);
      x2 = Math.floor(position.x + 1 - epsilon);
      y2 = Math.floor(position.y + 1 - epsilon);
      return (x1 >= 0) && (y1 >= 0) && (x2 < map.cols) && (y2 < map.rows) && map.getCell(x1, y1).passable && map.getCell(x1, y2).passable && map.getCell(x2, y1).passable && map.getCell(x2, y2).passable;
    };
    gameLoop = new GameLoop(this.tick);
    return gameLoop.run();
  };

  Rightbomber.prototype.tick = function(timeDelta) {
    var direction, _i, _len, _ref;
    this.player.moving = false;
    _ref = ['right', 'up', 'left', 'down'];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      direction = _ref[_i];
      if (this.keyboard.keys[direction]) {
        this.player.moving = true;
        this.player.setDirection(direction);
      }
    }
    this.player.move(timeDelta);
    return this.playerRepresentation.update();
  };

  return Rightbomber;

})();
